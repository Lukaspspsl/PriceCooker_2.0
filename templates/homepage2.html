<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>PriceCooker</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="dark-bg">
<header class="header text-center">
    <!-- Navigation Bar -->
    <!-- Include Login/Register buttons if not logged in, or a logout button if logged in -->


    <h1 class="white-text mt-5 display-2">PriceCooker</h1>
    <p class="white-text mt-3 lead">Give me an item and I will keep an eye on the price.</p>
</header>

<main>

    <div class="container mt-5">
        <div class="neon-box">
            <form class="form-card">
                <input type="text" name="itemURL" class="url-box" placeholder="Enter URL of the item">
                <button type="submit" class="submit-button">Submit</button>
            </form>
        </div>

        <ul class="list-unstyled mt-5">
            {% for item in items %}
                <li class="url-item" onclick="toggleCard('{{ item['_id'] }}')">
                    <div class="item-container">
                        <span class="item-title">{{ item['name'] }}</span>
                        <span class="delete-item" onclick="deleteItem('{{ item['_id'] }}', event)"
                              title="Delete item">X</span>
                    </div>

                    <div id="{{ item['_id'] }}-card" class="price-card">
                        <canvas id="{{ item['_id'] }}-chart"></canvas>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>
    <script>
        //extends card with price data
        function toggleCard(itemId) {
        const card = document.getElementById(`${itemId}-card`);
        card.style.display = card.style.display === 'none' ? 'flex' : 'none';
    }

        // Delete an item and refresh the page
    function deleteItem(itemId, event) {
        event.stopPropagation(); // Prevent triggering toggleCard
        if (confirm('Are you sure you want to delete this item?')) {
            fetch(`/item/${itemId}`, {
                method: 'DELETE',
            })
            .then(response => response.json())
            .then(data => {
                if (data.message === "Item deleted") {
                    location.reload(); // Reload page to update the list
                }
            })
            .catch(error => console.error('Error deleting item:', error));
        }
    }

    </script>
</main>

<footer>
    <!-- Footer Content -->
</footer>
</body>
</html>
